(function(){	var guardElements = { table:1, ul:1, ol:1, blockquote:1, div:1 };	var pluginName = 'more';	var moreCmd = {		exec : function( editor ) {			var selectedText = editor.getSelectedHtml();			var selection = editor.getSelection(),			enterMode = editor.config.enterMode,			ranges = selection.getRanges();						var selectedElement = selection.getCommonAncestor();			var parentElement = selectedElement.getParent();			var parentsElements = selectedElement.getParents();			var className;			var hasCkmore = false;						for(var i=1; i<=8; i++) {				if(parentsElements[i] && parentsElements[i].$.attributes.class) {					className = parentsElements[i].$.attributes.class.nodeValue;										if(className == 'ckmore') {						var hasCkmore = true;						var ckElement = parentsElements[i];					}				}			}						var insertedText = parentElement.$.innerHTML;						if(selectedText && hasCkmore==false) {				editor.insertHtml('<div class="ckmore">'+selectedText+'</div>');			} else if(hasCkmore==true) {				var pasteHTML = ckElement.$.innerHTML;								ckElement.remove();				editor.insertHtml(pasteHTML);			}		}	};	CKEDITOR.plugins.add('more', {		init : function(editor) {			var command = editor.addCommand(pluginName, moreCmd);						command.modes = {wysiwyg:1, source:1};			command.canUndo = true;			editor.ui.addButton('more', {				label : 'Создать раскрывающийся блок',				command : pluginName,				icon: this.path+'more.gif'			});			CKEDITOR.dialog.add('more', this.path + 'dialogs/more.js');		}	});})();